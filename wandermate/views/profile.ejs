<!DOCTYPE html>
<html>
<head>

  <link rel="stylesheet"  href="https://demos.creative-tim.com/argon-design-system-pro/assets/css/argon-design-system.min.css?v=1.0.0">
  <link rel="stylesheet" href="https://demos.creative-tim.com/argon-design-system-pro/assets/css/font-awesome.css">
  <link rel="stylesheet" href="https://demos.creative-tim.com/argon-design-system-pro/assets/css/nucleo-icons.css">
  <link rel="stylesheet" href="https://demos.creative-tim.com/argon-design-system-pro/assets/css/nucleo-svg.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <!-- <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.min.js"></script> -->
  <script src="https://kit.fontawesome.com/ea0619ce99.js" crossorigin="anonymous"></script>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js" ></script>
  <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>


<style>

.notifimg{
  color: #fff;
  background-color: #adb5bd;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  border-radius: 50%;
  height: 48px;
  width: 48px
}

  #wander {
    line-height: 50px;
    position: fixed;
    float: left;
    margin: 17px 220px;
    color: grey;
    font-weight: 600 !important ;
    font-size: 14px;
    letter-spacing: 2px;
    transition: 1s
  }

  nav {
    position: fixed;
    width: 102%;
    line-height: 60px;
    z-index: 1000;
    overflow-y: visible;
    border-width: thin;
    padding: 10px;
    background: #fafbfc;
    box-shadow:0 4px 4px -2px #495057;
  }

  nav ul {
    line-height: 50px;
    list-style: none;
    background: rgba(0, 0, 0, 0);
    color: grey;
    padding: 0;
    text-align: right;
    margin: 0;
    padding-right: 40px;
    transition: 1s;
  }

  nav ul li {
    display: inline-block;
    padding: 10px 20px;
  }

  nav ul li a {
    text-decoration: none;
    color: grey;
    font-size: 16px;
  }


  .myedit{
          padding-left : 20px;
          padding-top : 10px;
          width: 22%;
        }
  #form{
    padding-top : 1px;
    background-color:white;
    width: 100%;
    padding-bottom:0px;
  }

  #first{


  }
  #second{
          padding-left:30px;
  }
  #third{

  }

  h2{
      font-family: verdana;
      padding:0px;;
  }
  .jumbotron{

  }
  #line1{
    width : 400px;
    padding-left: 30px;
    padding-top: 0px;
    padding-bottom: 0px;
    margin : 0px;
  }
  .list{
    overflow : auto;
    height : 400px;
  }
  .list::-webkit-scrollbar{
    display : none;
  }
  #line2{
    padding-left :;
    width : 300px;
    padding-top: 0px;
    padding-bottom: 0px;
    margin : 0px;
  }
  #line3{
    width : 300px;
    padding-top: 0px;
    padding-bottom: 0px;
    margin : 0px;
  }
  #heading2{
    padding-left : 40px;
  }
  .bookings {
    display : flex;
    overflow-x: auto;
  }
  .bookings::-webkit-scrollbar{
    display : none;
  }
  .new{
    min-width : 22%;
    margin : 10px;

  }

  .star{
        color: goldenrod;
        font-size: 2.0rem;
        padding: ; /* space out the stars */
      }
      .star::before{
        content: '\2606';    /* star outline */
        cursor: pointer;
      }
      .star.rated::before{
        /* the style for a selected star */
        content: '\2605';  /* filled star */
      }

      .stars{
          counter-reset: rateme 0;
          font-size: 2.0rem;
          font-weight: 900;
      }
      .star.rated{
          counter-increment: rateme 1;
      }
      .stars::after{

      }


</style>

</head>
<body style="overflow-x:hidden;">
  <div class="row" style="top:0px;position:fixed;z-index:100">
    <nav id="nav" style="z-index:5;padding-top:0.2%;padding-bottom:0.05%;border:none;" class="navpic">
      <div class="logo">
        <span id="wander">WANDERMATE</span>
      </div>
      <div class="menu"  style="overflow:visible!important;">
        <ul id="ul" style="margin-left:60%;margin-top:0.4%;">
          <center>
           <li><a class="items" href="/users/dashboard"><i class="fas fa-home"></i></a></li>
           <li><a class="items" href="/blog"><i class="fas fa-blog"></i></a></li>
           <li class="dropdown">
             <i class="fas fa-bell dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
               <!-- <button style="color:grey;font-size:16px;margin-top:-2%;" class="btn btn-outline-link dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               </button> -->
               <div style="min-width:23rem;" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                 <!-- <a style="padding-top:2px;" class="dropdown-item" href="/users">Profile</a>
                 <a style="padding-top:2px;" class="dropdown-item" href="#">WanderList</a>
                 <a style="padding-top:2px;" class="dropdown-item" href="/users/logout">Logout</a> -->
                 <% if(user.notifications) {%>
                     <div class="px-3 py-3">
                       <h6 class="text-sm text-muted m-0">You have <strong class="text-primary"><%=user.notifications.length%></strong> notifications.</h6>
                     </div>

                     <div class="list-group list-group-flush" id="notifications">

                 <% for(i=0;i < user.notifications.length;i++ ){ %>
                       <a href="#" onclick="noti('<%=user.notifications[i]._id%>','<%=user.notifications[i].img %>')" data-toggle="modal" data-target="#myModal" class="list-group-item list-group-item-action">
                         <div class="row align-items-center">
                           <div class="col-auto">
                             <img alt="Image placeholder" src="<%=user.notifications[i].img %>" class="notifimg rounded-circle">
                           </div>
                           <div class="col ml--2">
                             <div class="d-flex justify-content-between align-items-center">
                               <div>
                                 <h4 style="font-family: inherit;font-weight: 400;line-height: 1.5;color: #32325d;" class="mb-0 text-sm"><%=user.notifications[i].senderid%></h4>
                               </div>
                               <div class="text-right text-muted">
                                 <small></small>
                               </div>
                             </div>
                             <p style="margin-bottom: 0!important;font-weight: 300;line-height: 1.7;" class="text-sm mb-0">Let's meet at Starbucks at 11:30. Wdyt?</p>
                           </div>
                         </div>
                       </a>
                         <a href="#" class="text-center text-primary">View all</a>
                       <%} %>

                     </div>
                       <%}else{ %>
                         <p>No Notifications</p>
                       <%}%>

               </div>
           </li>
           <li class="dropdown" style="margin-left:-4%;">
               <button style="color:grey;font-size:16px;margin-top:-2%;" class="btn btn-outline-link dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                 <i class="far fa-user-circle"><small><b><%= user.username %></b></small></i>
               </button>
               <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                 <a style="padding-top:2px;" class="dropdown-item" href="/users">Profile</a>
                 <a style="padding-top:2px;" class="dropdown-item" href="/wanderlist/<%= user.username %>">WanderList</a>
                 <a style="padding-top:2px;" class="dropdown-item" href="/users/logout">Logout</a>
               </div>
           </li>
         </center>
        </ul>
      </div>
    </nav>
  </div>
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg">

      <div class="modal-content" style="background-color: #DDDDDD;background-image:linear-gradient(rgba(255,255,255,0.4), rgba(255,255,255,0.4) 75%), url('https://lstore.graphics/paaatterns/images/Waiau-3-p-1080.jpeg');background-size:contain;background-position:150% 100%;background-repeat:no-repeat;">
        <div class="modal-header">
          <h4 class="modal-title">Testimonial</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <table style="width:100%;padding:3%;">
            <tr>
              <td style="width:38%;padding-top:3%;padding-bottom: 1.5%;text-align:center;">
                <img style="width:40vh;height:40vh;border-radius:3px;box-shadow:0 10px 25px 0 rgba(0,0,0,.3);"  id="testmodelimg" alt="Raised Image" class="rounded img-raised">
                <a style="float:right;" class="btn btn-link" href="#">Go to Profile..</a>
              </td>
              <td style="width:58%;">
                <form action="/users/testimonial/" method="POST">
                  <input style="display:none;" type="text" id="testusername" name="username" value="Roshan">
                  <input style="display:none;" type="text" id="testguidename" name="guidename" value="guide2">
                  <h1 style="color:#919293;">Guide2</h1>
                  <div class="form-group" style="margin-top:5%;">
                    <label for="exampleFormControlTextarea1">Your Feedback</label>
                    <textarea name="text" placeholder="Give your feedback please..." class="form-control" id="exampleFormControlTextarea1" rows="6"></textarea>
                  </div>
                  <input style="float:right;" class="btn btn-success btn-sm" type="submit" name="submit" value="Submit">
                </form>
              </td>
            </tr>
          </table>
          <div class="modal-footer" style="border-top:none;">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>

    </div>
  </div>
  <% var past = 0 %>
  <% var boo = 0 %>
  <% for ( var i = 0; i < user.booking.length; i++ ) { %>
  <% if ( user.booking[i].date_n_time.date < date ) { %>
    <% past++;
   } %>
  <% if ( user.booking[i].date_n_time.date > date ) { %>
    <% boo++;
   } %>
  <% } %>
      <div class="row" style="margin-top:7%;margin-left:7%;">
      <div class="myedit" id = "first" style="width:23%;">
            <div class="card card-profile" data-image="profile-image">
              <div class="card-header">
                <div class="card-image">
                  <a href="javascript:;">
                    <input type="image" id="image" src="<%=user.img.path%>" width="322px"/>
                    <input type="file" id="my_file" style="display: none;" />
                  </a>
                </div>
              </div>
              <div class="card-body pt-0">
                <h4 class="display-4 mb-0"><%=user.name%></h4>
                <p class="lead"><%=user.city%></p>
                <div class="table-responsive">
                  <ul class="list-unstyled ">
                    <li class="py-1">
                      <div class="d-flex align-items-center">
                        <div>
                          <div class="badge badge-circle badge-info mr-3">
                            <i class="fa fa-phone"></i>
                          </div>
                        </div>
                        <div>
                          <h6 class="mb-1"><%= user.phone_number %></h6>
                        </div>
                      </div>
                    </li>
                    <li class="py-1">
                      <div class="d-flex align-items-center">
                        <div>
                          <div class="badge badge-circle badge-success mr-3">
                            <i class="ni ni-user-run"></i>
                          </div>
                        </div>
                        <div>
                          <h6 class="mb-1">places visited  <%= past %></h6>
                        </div>
                      </div>
                    </li>
                    <li class="py-1">
                      <div class="d-flex align-items-center">
                        <div>
                          <div class="badge badge-circle badge-danger mr-3">
                            <i class="ni ni-chart-bar-32"></i>
                          </div>
                        </div>
                        <div>
                          <h6 class="mb-1">bookings    <%= boo %></h6>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div style="padding-left:5%;">
            <h2>Edit Profile</h2>
            <hr id="line1" noshade>
          <div id="form" class="jumbotron shadow-sm p-3 mb-5 bg-white rounded">
            <form action='/users/' method='POST' autocomplte='off'>
              <div class="form" style="padding-top  :10px;">
                <div class="form-group">
                  <label for="name">Name</label>
                  <input style="width:99%" type="text" class="form-control" id="name"  placeholder="Enter name" name = 'name' value=<%= user.name %>>
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <input style="width:99%" type="email" class="form-control" id="email"  placeholder="Enter Email" name = 'email' value=<%= user.email %> readonly>
                </div>
                <div class="form-row">
                  <div class="form-group md-col-6">
                    <label for="username">Username</label>
                    <input type="text" class="form-control" id="username"  placeholder="Enter Username" name = 'username' value=<%= user.username %>>
                  </div>
                  <div style="padding-left:121px" class="form-group md-col-6">
                    <label for="phone">Phone</label>
                    <input type="text" class="form-control" id="phone"  placeholder="Enter number" name = 'phone' value=<%= user.phone_number %>>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group md-col-6">
                    <label for="city">City</label>
                    <input type="text" class="form-control" id="city"  placeholder="Enter city" name = 'city' value=<%= user.city %>>
                  </div>
                  <div style="padding-left:121px" class="form-group md-col-6">
                    <label for="state">State</label>
                    <input type="text" class="form-control" id="state"  placeholder="Enter state" name = 'state' value=<%= user.state %>>
                  </div>
                </div>

                <input class="btn btn-icon btn-primary mt-0" type="submit">
              </div>
            </form></div></div>
          </div>
          <h2 id="currentbookings">Previous Bookings</h2>
          <!-- <hr id="line3" noshade> -->
          <div class="section features-7 bg-secondary">
          <div class="bookings">
            <% for ( var i = 0; i < user.booking.length; i++ ) { %>
                <% if ( user.booking[i].current == false ) { %>
                        <div class="new">
                          <div class="col">
                            <div class="card card-lift--hover shadow border-0">
                              <div class="card-body py-5">
                                <div class="icon icon-shape icon-shape-primary rounded-circle mb-4">
                                  <i class="ni ni-istanbul"></i>
                                </div>
                                <h6 class="text-primary text-uppercase"><%= user.booking[i].guide %></h6>
                                <p class="description mt-3"><%= user.booking[i].date_n_time.date %></p>
                                <p class="description mt-3"><%= user.booking[i].place %></p>
                                <p class="description mt-3">The Taj Mahal was designated as a UNESCO World Heritage Site in 1983 for being "the jewel of Muslim art in India and one of the universally admired masterpieces of the world's heritage"</p>
                                <div class="stars" data-rating="<%= user.booking[i].rating %>">
                                  <span class="star"></span>
                                  <span class="star"></span>
                                  <span class="star"></span>
                                  <span class="star"></span>
                              		<span class="star"></span>
                              	</div>
                              	<input type="text" id="st" hidden></input>
                                <a class="btn btn-primary mt-4" style="color:white" onclick="rating('<%= user.booking[i].guide %>','<%= user.booking[i].date_n_time.date %>', '<%= user.booking[i].date_n_time.time %>', '<%= user.booking[i]._id %>')">submit</a>
                                <a href="/chat/<%= user.name %>/<%= user.booking[i].guide %>" class="btn btn-primary mt-4">Chat</a>
                              </div>
                            </div>
                          </div>
                        </div>
                        <% } %>
                    <% } %>

          </div></div>


          <script type="text/javascript">
          function rating(x,y,z,p){
          console.log('called')
            $.ajax({
              type:'POST',
              url:'/users/st',
              data:{
                st:document.getElementById('st').value,
               guide:x,
               date:y,
               time:z,
               id:p
              },
              sucess:function(){
                return false
              }
            });

          };

          </script>





            <script>
              $("input[type='image']").click(function() {
                $("input[id='my_file']").click();
              });
            </script>
            <script>

              //initial setup
              document.addEventListener('DOMContentLoaded', function(){
                  let stars = document.querySelectorAll('.star');
                  stars.forEach(function(star){
                      star.addEventListener('click', setRating);
                  });

                  let rating = parseInt(document.querySelector('.stars').getAttribute('data-rating'));
                  let target = stars[rating - 1];
                  target.dispatchEvent(new MouseEvent('click'));
              });
              function setRating(ev){
                  let span = ev.currentTarget;
                  let stars = document.querySelectorAll('.star');
                  let match = false;
                  let num = 0;
                  stars.forEach(function(star, index){
                      if(match){
                          star.classList.remove('rated');
                      }else{
                          star.classList.add('rated');
                      }
                      //are we currently looking at the span that was clicked
                      if(star === span){
                          match = true;
                          num = index + 1;
                      }
                  });
      			document.getElementById("st").value = num
                  document.querySelector('.stars').setAttribute('data-rating', num);
              }

          </script>
            <!-- <script type="text/javascript">
            window.onscroll = function(){
              var navbar = document.getElementById('nav')
            //   var wander = document.getElementById('wander')
            //   var items = document.getElementsByClassName('items')
            //   var count = document.getElementById('count')
            //   var btn = document.getElementById('dropdownMenuButton')
            //   var ul = document.getElementById('ul')

              if (window.pageYOffset < 250){
                navbar.style.background = "rgba(0, 0, 0, 0)";
            //     navbar.style.boxShadow = 'none';
            //     wander.style.color = "#ffffff";
            //     wander.style.marginTop = "35px"
            //     ul.style.marginTop = "1.7%";
            //     btn.style.color = '#ffffff';
            //     for(var i=0; i<items.length; i++){
            //       items[i].style.color = "#ffffff";
            //       items[i].onmouseover = function(){
            //         items[i].style.color = "#06b995";
            //       }
            //     }
              } else {
                navbar.style.background = '#fff';
            //     navbar.style.boxShadow = "0 4px 4px -2px #495057";
            //     wander.style.color = "grey";
            //     btn.style.color = 'grey';
            //     wander.style.marginTop = "17px"
            //     ul.style.marginTop = "0.4%";
            //     for(var i=0; i<items.length; i++){
            //       items[i].style.color = "grey";
            //       items[i].onmouseover = function(){
            //         items[i].style.color = "black";
            //       }
            //     }
            //   }
            }
            </script> -->

    </body>
</html>
